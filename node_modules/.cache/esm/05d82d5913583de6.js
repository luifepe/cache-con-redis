let redis;_135‍.x([["verificoEnCache",()=>verificoEnCache],["find",()=>find]]);_135‍.w("redis",[["default",["redis"],function(v){redis=v}]]);
const redisClient = redis.createClient(6379, '127.0.0.1')

const chavePlate = () => {
    return {
        placa: 'ABC',
        renavam:123,
        debitos:[
            {
                valor:200,
                descricao: "Multa A"
            },
            {
                valor: 500,
                descricao: "Multa B"
            }            
        ]                
    }
}


const chavePlate2 = () => {
    return {
        placa: 'DEF',
        renavam: 123,
        debitos: "Sem debitos"
    }
}


const verificoEnCache = (plate) => {

    redisClient.get(`${plate}`, (err, obj) => {

        if (obj) {
            console.log('Encontrado en la cache')
            return obj
        }

        console.log('Buscando información fuera de la cache')
        redisClient.setex(`${plate}`, 3600, JSON.stringify (chavePlate()))
        return chavePlate()

    })
    
    return chavePlate()
}













const find = (verificoEnCache) = () => {
    
    if ( chavePlate.placa === 'ABC' && chavePlate.renavam === 123){
        console.log('Encontrado en la cache')
        return{
            placa: 'ABC',
            renavam:123,
            debitos:[
                {
                    valor:200,
                    descricao: "Multa A"
                },
                {
                    valor: 500,
                    descricao: "Multa B"
                }
            ]
        }
    }
        
    return verificoEnCache

}
    


